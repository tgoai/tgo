services:
  # RAG services (reuse same image, override build context when in source mode)
  tgo-rag-worker:
    image: tgo-rag:local
    build:
      context: ./repos/tgo-rag

  tgo-rag-beat:
    image: tgo-rag:local
    build:
      context: ./repos/tgo-rag

  tgo-rag:
    image: tgo-rag:local
    build:
      context: ./repos/tgo-rag

  # AI service
  tgo-ai:
    image: tgo-ai:local
    build:
      context: ./repos/tgo-ai

  # API service
  tgo-api:
    image: tgo-api:local
    build:
      context: ./repos/tgo-api

  # Plugin Runtime service
  tgo-plugin-runtime:
    image: tgo-plugin-runtime:local
    build:
      context: ./repos/tgo-plugin-runtime
    volumes:
      - ./data/plugins:/var/lib/tgo/plugins
      - plugin-socket:/var/run/tgo

  # Device Control service
  tgo-device-control:
    image: tgo-device-control:local
    build:
      context: ./repos/tgo-device-control

  # Platform service
  tgo-platform:
    image: tgo-platform:local
    build:
      context: ./repos/tgo-platform

  # Workflow service
  tgo-workflow:
    image: tgo-workflow:local
    build:
      context: ./repos/tgo-workflow

  tgo-workflow-worker:
    image: tgo-workflow:local
    build:
      context: ./repos/tgo-workflow

  # Customer-facing web app
  tgo-web:
    image: tgo-web:local
    build:
      context: ./repos/tgo-web
      args:
        VITE_WIDGET_PREVIEW_URL: ${VITE_WIDGET_PREVIEW_URL:-http://localhost:${WIDGET_PORT:-3001}}
    environment:
      # Runtime environment variables (injected by docker-entrypoint.sh)
      VITE_API_BASE_URL: ${VITE_API_BASE_URL:-http://localhost:${API_PORT:-8000}}
      VITE_DEBUG_MODE: ${VITE_DEBUG_MODE:-false}

  # Widget app
  tgo-widget-app:
    image: tgo-widget-app:local
    build:
      context: ./repos/tgo-widget-app
      args:
        VITE_API_BASE: ${VITE_API_BASE:-http://localhost:${API_PORT:-8000}}
    environment:
      # Runtime environment variables (injected by docker-entrypoint.sh)
      VITE_API_BASE: ${VITE_API_BASE:-http://localhost:${API_PORT:-8000}}

volumes:
  plugin-socket:

