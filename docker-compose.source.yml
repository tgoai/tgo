services:
  # RAG services (reuse same image, override build context when in source mode)
  tgo-rag-worker:
    image: tgo-rag:local
    build:
      context: ./repos/tgo-rag

  tgo-rag-beat:
    image: tgo-rag:local
    build:
      context: ./repos/tgo-rag

  tgo-rag-flower:
    image: tgo-rag:local
    build:
      context: ./repos/tgo-rag

  tgo-rag:
    image: tgo-rag:local
    build:
      context: ./repos/tgo-rag

  # AI service
  tgo-ai:
    image: tgo-ai:local
    build:
      context: ./repos/tgo-ai

  # API service
  tgo-api:
    image: tgo-api:local
    build:
      context: ./repos/tgo-api

  # Platform service
  tgo-platform:
    image: tgo-platform:local
    build:
      context: ./repos/tgo-platform

  # Customer-facing web app
  tgo-web:
    image: tgo-web:local
    build:
      context: ./repos/tgo-web
      args:
        VITE_WIDGET_PREVIEW_URL: ${VITE_WIDGET_PREVIEW_URL:-http://localhost:${WIDGET_PORT:-3001}}
    environment:
      # Runtime environment variables (injected by docker-entrypoint.sh)
      VITE_API_BASE_URL: ${VITE_API_BASE_URL:-http://localhost:${API_PORT:-8000}}
      VITE_DEBUG_MODE: ${VITE_DEBUG_MODE:-false}

  # Widget app
  tgo-widget-app:
    image: tgo-widget-app:local
    build:
      context: ./repos/tgo-widget-app
      args:
        VITE_API_BASE: ${VITE_API_BASE:-http://localhost:${API_PORT:-8000}}
    environment:
      # Runtime environment variables (injected by docker-entrypoint.sh)
      VITE_API_BASE: ${VITE_API_BASE:-http://localhost:${API_PORT:-8000}}

